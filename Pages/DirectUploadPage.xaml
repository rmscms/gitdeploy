<Page x:Class="GitDeployPro.Pages.DirectUploadPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
      mc:Ignorable="d" 
      Title="DirectUploadPage"
      Background="#202020" d:DesignHeight="600" d:DesignWidth="800">

    <Grid Margin="30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="200"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
            <TextBlock Text="ðŸ“¤" FontSize="36" VerticalAlignment="Center" Margin="0,0,15,0" Foreground="White"/>
            <StackPanel VerticalAlignment="Center">
                <TextBlock Text="Direct Upload" 
                          FontSize="32" 
                          FontWeight="Bold" 
                          Foreground="White"/>
                <TextBlock Text="Select files and folders to upload directly via FTP" 
                          FontSize="14" 
                          Foreground="#AAAAAA" 
                          Margin="2,4,0,0"/>
                <TextBlock x:Name="ConnectionInfoText"
                           Text="Detecting connection..."
                           FontSize="13"
                           Foreground="#64B5F6"
                           Margin="0,6,0,0"/>
            </StackPanel>
            <Button Content="ðŸ—– Pop-out"
                    Margin="25,0,0,0"
                    Padding="14,4"
                    Background="#333333"
                    Foreground="#EEEEEE"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="DetachDirectUploadPage_Click"/>
        </StackPanel>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="#2B2B2B" CornerRadius="8" Padding="15" Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button x:Name="RefreshButton" Click="RefreshButton_Click" Background="Transparent" BorderThickness="0" Margin="0,0,10,0" Cursor="Hand">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ”„" Foreground="#4FC3F7" Margin="0,0,5,0"/>
                            <TextBlock Text="Refresh Files" Foreground="#E0E0E0"/>
                        </StackPanel>
                    </Button>
                    <Button x:Name="SelectAllButton" Click="SelectAllButton_Click" Background="Transparent" BorderThickness="0" Margin="10,0" Cursor="Hand">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="â˜‘ï¸" Foreground="#81C784" Margin="0,0,5,0"/>
                            <TextBlock Text="Select All" Foreground="#E0E0E0"/>
                        </StackPanel>
                    </Button>
                    <Button x:Name="DeselectAllButton" Click="DeselectAllButton_Click" Background="Transparent" BorderThickness="0" Margin="10,0" Cursor="Hand">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="â¬œ" Foreground="#E57373" Margin="0,0,5,0"/>
                            <TextBlock Text="Deselect All" Foreground="#E0E0E0"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock Text="Total Files: " Foreground="#AAAAAA" VerticalAlignment="Center"/>
                    <TextBlock x:Name="TotalFilesText" Text="0" Foreground="White" FontWeight="Bold" VerticalAlignment="Center" Margin="5,0,15,0"/>
                    
                    <TextBlock Text="Selected: " Foreground="#AAAAAA" VerticalAlignment="Center"/>
                    <TextBlock x:Name="SelectedFilesText" Text="0" Foreground="#81C784" FontWeight="Bold" VerticalAlignment="Center" Margin="5,0,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- File Tree -->
        <Border Grid.Row="2" Background="#252526" CornerRadius="8" BorderBrush="#3F3F3F" BorderThickness="1">
            <TreeView x:Name="FileTreeView" 
                      Background="Transparent" 
                      BorderThickness="0" 
                      Padding="10"
                      VirtualizingStackPanel.IsVirtualizing="True"
                      VirtualizingStackPanel.VirtualizationMode="Recycling">
                <TreeView.ItemContainerStyle>
                    <Style TargetType="{x:Type TreeViewItem}">
                        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                        <Setter Property="Foreground" Value="#E0E0E0"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="Padding" Value="4,2"/>
                    </Style>
                </TreeView.ItemContainerStyle>
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                        <StackPanel Orientation="Horizontal" Margin="2">
                            <CheckBox IsChecked="{Binding IsChecked, Mode=TwoWay}" 
                                      VerticalAlignment="Center" 
                                      Margin="0,0,8,0"
                                      Click="ItemCheckBox_Click"/>
                            <TextBlock Text="{Binding Icon}" 
                                      Foreground="{Binding IconColor}"
                                      Margin="0,0,6,0" 
                                      FontFamily="Segoe UI Emoji"/>
                            <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding SizeDisplay}" 
                                      FontSize="11" 
                                      Foreground="#808080" 
                                      Margin="10,0,0,0" 
                                      VerticalAlignment="Center"
                                      Visibility="{Binding SizeVisibility}"/>
                            <TextBlock Text="{Binding UploadBadgeText}"
                                       FontSize="12"
                                       FontWeight="Bold"
                                       Margin="8,0,0,0"
                                       VerticalAlignment="Center"
                                       Foreground="{Binding UploadBadgeBrush}"
                                       Visibility="{Binding UploadBadgeVisibility}"/>
                        </StackPanel>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>
        </Border>

        <!-- Footer / Upload Button -->
        <Grid Grid.Row="3" Margin="0,20,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel Grid.Column="0">
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <CheckBox x:Name="UseSessionCheck" 
                              Content="Enable Crash Recovery" 
                              IsChecked="True" 
                              Foreground="White" 
                              FontWeight="SemiBold" 
                              VerticalAlignment="Center"
                              Margin="0,0,10,0" 
                              ToolTip="Keeps a log of uploaded files to resume if connection fails."/>
                    
                    <TextBlock x:Name="SessionStatusText" 
                               Text="" 
                               Foreground="#FFC107" 
                               FontSize="12" 
                               VerticalAlignment="Center" 
                               Margin="0,0,10,0"/>

                    <Button x:Name="DeleteSessionButton" 
                            Content="ðŸ—‘ï¸ Clear Session" 
                            Visibility="Collapsed"
                            Background="Transparent" 
                            Foreground="#E57373" 
                            BorderThickness="0" 
                            FontSize="11"
                            VerticalAlignment="Center"
                            Cursor="Hand"
                            Click="DeleteSessionButton_Click"
                            ToolTip="Delete the saved session file manually"/>

                    <CheckBox x:Name="OverwriteCheck" Content="Force Overwrite" IsChecked="True" Foreground="#AAAAAA" Margin="15,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
                
                <TextBlock x:Name="StatusText" Text="Ready." Foreground="#AAAAAA" FontSize="13" Margin="0,0,0,5"/>
                <TextBlock x:Name="UploadDetailText" Text="" Foreground="#DDDDDD" FontSize="12" Margin="0,0,0,5"/>
                <ProgressBar x:Name="UploadProgressBar" Height="6" Margin="0,0,20,0" Background="#333" Foreground="#0078D4" Value="0"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button x:Name="StopButton"
                        Content="â›” STOP"
                        Height="45"
                        Width="100"
                        Margin="0,0,10,0"
                        FontSize="14"
                        FontWeight="Bold"
                        Background="#C62828"
                        Foreground="White"
                        BorderThickness="0"
                        Cursor="Hand"
                        IsEnabled="False"
                        Click="StopButton_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="6">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter TargetName="border" Property="Background" Value="#444444"/>
                                                <Setter Property="Foreground" Value="#888888"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>

                <Button x:Name="StartUploadButton"
                        Content="ðŸš€ START UPLOAD" 
                        Height="45"
                        Width="160"
                        FontSize="14"
                        FontWeight="Bold"
                        Background="#0078D4"
                        Foreground="White"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="StartUploadButton_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="6">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#1084D8"/>
                                            </Trigger>
                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter TargetName="border" Property="Background" Value="#444444"/>
                                                <Setter Property="Foreground" Value="#888888"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Upload Log Console -->
        <Border Grid.Row="4" Background="#1E1E1E" CornerRadius="8" BorderBrush="#3F3F3F" BorderThickness="1" Margin="0,15,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <Border Grid.Row="0" Background="#252526" CornerRadius="8,8,0,0" Padding="10,8">
                    <TextBlock Text="ðŸ“‹ Upload Log" Foreground="#E0E0E0" FontSize="13" FontWeight="SemiBold"/>
                </Border>
                
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" Padding="10">
                    <TextBox x:Name="UploadLogTextBox"
                            Background="Transparent"
                            Foreground="#00FF00"
                            FontFamily="Consolas"
                            FontSize="11"
                            IsReadOnly="True"
                            TextWrapping="Wrap"
                            BorderThickness="0"
                            Text="Ready. Waiting for upload..."/>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</Page>